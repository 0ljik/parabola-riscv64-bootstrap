--- a/PKGBUILD	2018-02-15 08:27:03.495301696 +0100
+++ b/PKGBUILD	2018-02-15 08:28:25.326381705 +0100
@@ -4,30 +4,32 @@
 # Contributor: Jan de Groot <jgc@archlinux.org>
 
 pkgname=libffi
-pkgver=3.2.1
+pkgver=3.1
 pkgrel=2
 pkgdesc='Portable foreign function interface library'
 arch=('x86_64')
-url='http://sourceware.org/libffi/'
+url='https://github.com/riscv/riscv-libffi'
 license=('MIT')
 depends=('glibc')
 checkdepends=('dejagnu')
-source=(ftp://sourceware.org/pub/libffi/libffi-$pkgver.tar.gz)
+source=(git+https://github.com/riscv/riscv-libffi.git)
 sha1sums=('280c265b789e041c02e5c97815793dfc283fb1e6')
 
 build() {
-  cd $pkgname-$pkgver
-  ./configure --prefix=/usr --disable-static \
+  cd riscv-libffi/libffi-3.1
+  curl "https://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD" \
+    > config.sub
+  ./configure --host=@TARGET@ CFLAGS="-D__riscv64=1 $CFLAGS" --prefix=/usr --disable-static \
     --enable-pax_emutramp
   make
 }
 
 check() {
-  make -C $pkgname-$pkgver check
+  make -C riscv-libffi/libffi-3.1 check
 }
 
 package() {
-  cd $pkgname-$pkgver
+  cd riscv-libffi/libffi-3.1
   make DESTDIR="$pkgdir" install
   install -Dm644 LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
 }
